<table id='0' style='font-size:18px'><tr><td>Algorithm 2: SHADOWKV Decoding ERbxhkv Xnc (S1) ← maxkv group ▷ Select top-k chunks for each head IERbxhkv xk ArgTopK(S2,k) ← ▷ Gather values from CPU Vsparse ← Gather(VCPU ,I) V ← [Voutlier Vsparse ;V] ; ▷ Recover keys from low-rank projection Ksparse ← MatMul(Gather(A,I),B) K← [K outlier ;RoPE(Ksparse);K]</td></tr><tr><td>Input: A, B, L, VCPU QERbxhq xsqxd Koutlier , , , Voutlier K,V ERbxhkv xsqxd number of chunks nc, number , , of selected chunk budget k ▷ Compute chunk attention score P ERbxhq XSq Xnc MatMul(Q,L ← S ERbxhq XSq Xnc ← Softmax(P /Vd) S1 ERbxhq Xnc sum (S,dim = -2) ← S2 KV</td></tr></table>