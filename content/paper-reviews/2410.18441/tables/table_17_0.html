<br><table id='1' style='font-size:14px'><tr><td>Input: KV cache,t E R 1xd</td></tr><tr><td>tQ = tW⌀ix = tWrity = tWy</td></tr><tr><td>Q(XKg),XK,,Q(Xv),XV, ← KV cache</td></tr><tr><td>XKr = Concat([Xkr,tk],dim = token)</td></tr><tr><td>Xvr = Concat([Xvv,tv],dim = token)</td></tr><tr><td>if len(Xkr) = = S:</td></tr><tr><td>Q(XKr), - = Kquant(Xkr)</td></tr><tr><td>Sn = len(Q(Xkg))//S</td></tr><tr><td>if sn ≤ (qn - 2):</td></tr><tr><td>Q(Xkg⌀i) = Q(Xkg)[-ixS : (i - 1)xS],dim = token, for in range[1:s"]</td></tr><tr><td>XKg,i = GrpDeQuant(Q(Xkxi), dim = channel, qbits = Bi+1, numGroup = SIIG) for i in range[1:sn]</td></tr><tr><td>Q(Xkg,i) = GrpQuant(Xkg,i' dim = channel, qbits = Bi+2, numGroup = SI/G) for in range[1:s"]</td></tr><tr><td>else:</td></tr><tr><td>Q(Xkg,i) = Q(XK )[-ixS : (i- 1)xS], dim = token, for i in range[1:qn - 2] Q(XKg,qn-1) = Q(Xkg)[: - (qn - 2)xS]</td></tr><tr><td>XKg,i GrpDeQuant(Q(Xxg,i), dim = channel, qbits = Bi+1, numGroup = SI/G) for i in range[1:</td></tr><tr><td>= In - 2]</td></tr><tr><td>XKg,qn-1 = GrpDeQuant(Q(Xkgi), dim = channel, qbits = Bi+1, numGroup = (Sn - In + 2)S//G)</td></tr><tr><td>Q(Xkg,i) = GrpQuant(Xkg,i' dim = channel, qbits = Bi+2, numGroup = SIIG) for in range[1:qn - 2]</td></tr><tr><td>Q(XKg,qn-1) = GrpQuant(Xkg:qn-19 dim = channel, qbits = Bqn' numGroup = (Sn - In + 2)S//G)</td></tr><tr><td>if Sn ≤ (qn - 1):</td></tr><tr><td>Q(Xkg) = Concat([Q(Xkg.sn), · , Q(Xkg.1+Q(Xkr)], dim = token)</td></tr><tr><td>else:</td></tr><tr><td>Q(Xkg) = Concat([Q(XKg,qn-1), · · · , Q(Xkg,1), Q(Xkr)], dim = token)</td></tr><tr><td>XKr ← empty tensor</td></tr></table>